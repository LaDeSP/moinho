!function(e){"use strict";e('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var t=e(this.hash);if((t=t.length?t:e("[name="+this.hash.slice(1)+"]")).length)return e("html, body").animate({scrollTop:t.offset().top},1e3,"easeInOutExpo"),!1}}),e(".js-scroll-trigger").click(function(){e(".navbar-collapse").collapse("hide")}),e("body").scrollspy({target:"#sideNav"})}(jQuery);

var contador = 1;
var periodos = [];
var pesquisa = '';
var pesquisar = '';
var user_pesquisa = '';
var pag = 1; //Qual é a pagina atual
var limite = 1; //Limite de cartões que serão mostrados
var total_pag = 0; //Total de paginas
var total = 0; //Total de Cartões
var total_relativo = 0; //Total de Cartões que serão mostrados

String.prototype.replaceAll = function(search, replacement) {
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
}

function pesquisacep(valor, id) {

    //Nova variável "cep" somente com dígitos./
    var cep = valor.replace(/\D/g, '');
    element = $('#'+id);

    function meu_callback(conteudo) {
        if (!("erro" in conteudo)) {
            //Atualiza os campos com os valores.
            document.getElementById('rua').value=(conteudo.logradouro);
            document.getElementById('bairro').value=(conteudo.bairro);
            document.getElementById('cidade').value=(conteudo.localidade);
            document.getElementById('uf').value=(conteudo.uf);
        
        } //end if.
        else {
            //CEP não Encontrado.
            limpa_formulário_cep();
            alert("CEP não encontrado.");
        }
    }

    //Verifica se campo cep possui valor informado.
    if (cep != "") {

        //Expressão regular para validar o CEP.
        var validacep = /^[0-9]{8}$/;

        //Valida o formato do CEP.
        if(validacep.test(cep)) {

            //Campo Valido
            element.removeClass('is-invalid');
            element.addClass('is-valid');
            

            //Cria um elemento javascript.
            var script = document.createElement('script');

            //Sincroniza com o callback.
            script.src = '//viacep.com.br/ws/'+ cep + '/json/?callback=meu_callback';

            //Insere script no documento e carrega o conteúdo.
            document.body.appendChild(script);

            //verifica os elementos
            setTimeout(function(){
                verifica_vazio(document.getElementById('rua').value, 'rua');
                verifica_vazio(document.getElementById('bairro').value, 'bairro');
                verifica_vazio(document.getElementById('cidade').value, 'cidade');
                verifica_vazio(document.getElementById('uf').value, 'uf');
            }, 500);
        } //end if.
        else {
            //cep é inválido.
            element.removeClass('is-valid');
            element.addClass('is-invalid');
        }
    } //end if.
}

//Validação dos campos

function verifica_telefone(telefone, id){
    var validate = /^(?:(?:\+|00)?(55)\s?)?(?:\(?([1-9][0-9])\)?\s?)?(?:((?:9\d|[2-9])\d{3})\-?(\d{4}))$/;
    element = $('#'+id);
    if(validate.test(telefone)) {
        element.removeClass('is-invalid');
        element.addClass('is-valid');
    }
    else{
        element.removeClass('is-valid');
        element.addClass('is-invalid');
    }
}

function verifica_email(email, id){
    var validate = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    element = $('#'+id);
    if(validate.test(email)) {
        element.removeClass('is-invalid');
        element.addClass('is-valid');
    }
    else{
        element.removeClass('is-valid');
        element.addClass('is-invalid');
    }
}

function verifica_vazio(valor, id){
    element = $('#'+id);
    //console.log(valor);
    if(valor !== '') {
        element.removeClass('is-invalid');
        element.addClass('is-valid');
    }
    else{
        element.removeClass('is-valid');
        element.addClass('is-invalid');
    }
}

function verifica_vazio(valor, id){
    element = $('#'+id);
    //console.log(valor);
    if(valor !== '') {
        element.removeClass('is-invalid');
        element.addClass('is-valid');
    }
    else{
        element.removeClass('is-valid');
        element.addClass('is-invalid');
    }
}

function verifica_password(valor, id){
    element = $('#'+id);
    //console.log(valor);
    if(valor.length > 5) {
        element.removeClass('is-invalid');
        element.addClass('is-valid');
    }
    else{
        element.removeClass('is-valid');
        element.addClass('is-invalid');
    }
}

function confirmar_password(valor, password_id, confirm_id){
    password = $('#'+password_id);
    confirm = $('#'+confirm_id);
    password_val = password.val();
    confirm_val = confirm.val();
    if(password_val === confirm_val) {
        confirm.removeClass('is-invalid');
        confirm.addClass('is-valid');
        //console.log('ok');
    }
    else{
        //console.log('no');
        confirm.removeClass('is-valid');
        confirm.addClass('is-invalid');
    }
}

function verifica_cpf(cpf, id){
    var validate = /^[0-9]{3}.?[0-9]{3}.?[0-9]{3}-?[0-9]{2}/
    element = $('#'+id);
    if(validate.test(cpf)) {
        element.removeClass('is-invalid');
        element.addClass('is-valid');
    }
    else{
        element.removeClass('is-valid');
        element.addClass('is-invalid');
    }
}

function verifica_submit(classe){
    var elements = $('.'+classe);
    var cont = 0;
    elements.each(function(){
        if(!$(this).hasClass('is-valid')){
            cont++;
        }
    });

    if(cont == 0){
        //console.log(cont);
        $('#submit').removeClass( 'btn-outline-danger' );
        $('#submit').addClass( 'btn-outline-info' );
        $('#submit').removeAttr( 'disabled' );
    }
    else{
        //console.log(cont);
        $('#submit').removeClass( 'btn-outline-info' );
        $('#submit').addClass( 'btn-outline-danger' );
        $('#submit').attr( 'disabled', '' );
    }
    cont = 0;
}

function verifica_campo(classe){
    var elements = $('.'+classe);
    //console.log(elements);
    elements.each(function(){
        if(!$(this).hasClass('is-valid')){
            $(this).addClass('is-invalid');
        }
    });
}

//Criar um pdf de uma div
function printDiv(divName){
    var printContents = document.getElementById(divName).innerHTML;
    var originalContents = document.body.innerHTML;

    document.body.innerHTML = printContents;

    window.print();

    document.body.innerHTML = originalContents;
}

//Pesquisa na Tabela
function changeTable(target, id){
    var a = document.getElementById(id).value;
    //console.log(a);
    $(target+' tr').hide();
    if(a === 'all')
    {
        $(target+' tr').show();
    }
    else
    {
        $.each( $(target+' [class^="'+a), function(key, value) {
            $(value).show();
        });
    }
}

//Mudar o tipo de pesquisa
function changePesquisa(target, val){
    pesquisa = val;
    searchInformation('info');
    changeListGroup(target, pesquisar);
}

//Mudar o user da pesquisa
function changeUser(target, val, id){
    element = $('#'+id);
    switch(user_pesquisa){
        case '':
            user_pesquisa = val+' ';
            element.removeClass('btn-outline-info');
            element.addClass('btn-info');
            break;
        default:
            user_pesquisa = '';
            element.removeClass('btn-info');
            element.addClass('btn-outline-info');
            break;
    }
    searchInformation('info');
    changeListGroup(target, pesquisar);
}

//information
function searchInformation(id){
    //console.log('#'+id);
    switch(user_pesquisa){
        case '':
            $('#'+id).html(`<h3> Eventos > `+pesquisa+` </h3>`);
            break;
        default:
            $('#'+id).html(`<h3> Meus Eventos > `+pesquisa+` </h3>`);
            break;
    }
}

//Pesquisa na Lista
function changeListGroup(target, val){
    pesquisar = val;
    cont = 0;
    //console.log(pesquisar);
    switch(pesquisa){
        case '':
            val = user_pesquisa+val.toLowerCase();
            break;
        default:
            val = user_pesquisa+pesquisa+' '+val.toLowerCase();
            break;
    }
    while(val[ val.length -1] === ' '){
        val = val.substr(0,(val.length - 1));
        //console.log(val);
    }
    val = val.replaceAll(' ', ')(?=.*');
    regex = '^(?=.*'+val+').*$'
    var regex = new RegExp(regex, 'im');
    //console.log(regex);
    $( target ).hide();
    $( target ).removeClass('isvalid');
    if(val === 'all' || val === '')
    {
        $( target ).addClass('isvalid');
        $( target ).show();
        cont = total;
    }
    else
    {
        $.each( $(target), function(key, value) {
            cla = $(value).attr('class').toLowerCase();
            //console.log(cla);
            if( regex.test( cla )){
                //console.log('Entrou');
                $( value ).addClass('isvalid'); 
                $( value ).show(); 
                cont++;
            }
        });
    }
    console.log( cont );
    nova_paginacao( cont );
    cont = 0;
}

//Inserir horarios
function inserir(entrada, saida){
    //Entrada
    entrada = $('#'+entrada).val();
    nova_entrada = new Date(entrada);
    nova_entrada = nova_entrada.getDate()+`/`+( nova_entrada.getMonth()+1 )+`/`+nova_entrada.getFullYear()+' '+nova_entrada.getHours()+':'+nova_entrada.getMinutes();
    //Saida
    saida = $('#'+saida).val();
    nova_saida = new Date(saida);
    nova_saida = nova_saida.getDate()+`/`+( nova_saida.getMonth()+1 )+`/`+nova_saida.getFullYear()+' '+nova_saida.getHours()+':'+nova_saida.getMinutes();
    periodos.push({
        id: 0,
        inicio: nova_entrada,
        fim: nova_saida,
        entrada: entrada,
        saida: saida
    });
    var text = `
        <h5 class="mb-1">
            `+nova_entrada+`  
            &nbsp;ÁS&nbsp;
            `+nova_saida+`
        </h5>
    `;
    //console.log(entrada);
    input_in = `
        <input
            value=`+entrada+`
            style="display: none"
            type="datetime-local" 
            name="evento_in[]" 
            size="20" 
            class="form-control"
        >
    `
    //console.log(saida);
    input_out = `
        <input
            value=`+saida+`
            style="display: none"
            type="datetime-local" 
            name="evento_out[]"
            size="20" 
            class="form-control"
        >
    `
    input_id = `
        <input
            value=`+0+`
            style="display: none"
            type="number" 
            name="periodo_id[]"
            size="20" 
            class="form-control"
        >
    `
    text = `
        <div id=`+contador+` class="col-md-4 col-sm-6">
            <span href="#" class=" list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between">
                    `+text+``+input_in+``+input_out+``+input_id+`
                </div>
                <button type="button" onClick="excluir(`+contador+`)" class="btn btn-outline-success" >Excluir Horário</button>
            </span>
        </div>
    `
    contador++;
    $('#datas_horarios').append(text);
    //$('#datas_horarios').append(input_in);
    //$('#datas_horarios').append(input_out);
}

//Inserir horarios ja criados
function inserir_criados(entrada, saida, opcao, id){
    entrada = entrada.replace(' ', 'T');
    saida = saida.replace(' ', 'T');

    //console.log(saida);
    //console.log(entrada);
    //Entrada
    nova_entrada = new Date(entrada);
    nova_entrada = nova_entrada.getDate()+`/`+( nova_entrada.getMonth()+1 )+`/`+nova_entrada.getFullYear()+' '+nova_entrada.getHours()+':'+nova_entrada.getMinutes();
    //Saida
    nova_saida = new Date(saida);
    nova_saida = nova_saida.getDate()+`/`+( nova_saida.getMonth()+1 )+`/`+nova_saida.getFullYear()+' '+nova_saida.getHours()+':'+nova_saida.getMinutes();
    var text = `
        <h5 class="mb-1" id="evento_info`+contador+`">
            `+nova_entrada+`  
            &nbsp;ÁS&nbsp;
            `+nova_saida+`
        </h5>
    `;
    //console.log(entrada);
    input_in = `
        <input
            value=`+entrada+`
            style="display: none"
            type="datetime-local" 
            name="evento_in[]" 
            size="20" 
            class="form-control"
            id="evento_inicio`+contador+`" 
        >
    `;
    //console.log(saida);
    input_out = `
        <input
            value=`+saida+`
            style="display: none"
            type="datetime-local" 
            name="evento_out[]"
            size="20" 
            class="form-control"
            id="evento_fim`+contador+`"
        >
    `;
    input_id = `
        <input
            value=`+id+`
            style="display: none"
            type="number" 
            name="periodo_id[]"
            size="20" 
            class="form-control"
        >
    `;
    switch(opcao){
        case 0:
            text = `
                <div class="col-md-4 col-sm-6">
                    <span href="#" class=" list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            `+text+``+input_in+``+input_out+`
                        </div>
                    </span>
                </div>
            `;
            break;
        case 1:
            text = `
                <div id=`+contador+` class="col-md-4 col-sm-6">
                    <span href="#" class=" list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            `+text+``+input_in+``+input_out+``+input_id+`
                        </div>
                        <button type="button" onClick="excluir(`+contador+`)" class="btn btn-outline-success" >Excluir Horário</button>
                    </span>
                </div>
            `
            break;
    }
    contador++;
    $('#datas_horarios').append(text);
}

//Excluir elementos pelo id
function excluir(id){
    $('#'+id).remove();
}

//Inserir novo total relativo
function nova_paginacao( total ){
    pag = 1; //Qual é a pagina atual
    total_relativo = total; //Total de Cartões que serão mostrados
    total_pag = Math.ceil(total_relativo/limite); //Total de paginas
    atualizarPaginacao(1);
}

//Inserir dados da paginação
function paginacao( count, limit ){
    pag = 1; //Qual é a pagina atual
    limite = limit; //Limite de cartões que serão mostrados
    total = count; //Total de Cartões
    total_relativo = count; //Total de Cartões que serão mostrados
    total_pag = Math.ceil(total_relativo/limit); //Total de paginas
    criar_paginacao();
}

function criar_paginacao(){
    next = pag + 2;
    previous = 1;
    if(next <= 5 && 5 <= total_pag)
        next = 5;
    else{
        if(total_pag < 5){
            next = total_pag;
        }
        else{
            if(next > total_pag){
                next = total_pag;
                previous = total_pag - 4;
            }
            else{
                previous = next - 4;
            }
        }
    }

    paginas = "";
    previousText = "";
    nextText = "";
    morePrevious = "";
    moreNext = "";

    if(pag !== 1)
        previousText = `
            <li class="page-item">
                <span class="page-link" onClick="atualizarPaginacao(`+(pag - 1)+`)">Previous</span>
            </li>
        `;
    if(pag !== total_pag && total_pag !== 0)
        nextText = `
            <li class="page-item">
                <span class="page-link " onClick="atualizarPaginacao(`+(pag + 1)+`)">Next</span>
            </li>
        `;
    if(previous !== 1)
        morePrevious = `
            <li class="page-item">
                <a class="page-link">...</a>
            </li>
        `;
    if(next !== total_pag)
        moreNext = `
            <li class="page-item">
                <a class="page-link">...</a>
            </li>
        `;
    
    for(i = previous; i <= next; i++){
        if(pag === i){
            paginas = paginas + `
                <li class="page-item active">
                    <a class="page-link">
                        `+i+`
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
            `;
        }
        else{
            paginas = paginas + `
                <li class="page-item">
                    <a class="page-link" onClick="atualizarPaginacao(`+i+`)">`+i+`</a>
                </li>
            `;
        }
    }
    paginas = `
        <ul class="pagination justify-content-center">
                `+previousText+morePrevious+`
                `+paginas+`
                `+moreNext+nextText+`
        </ul>
    `
    $('#pagination').html(paginas);
}

function atualizarPaginacao(pagina){
    pag = pagina;
    elementos = $('.isvalid');
    elementos.hide();
    fim = pag * limite;
    if(fim > total_relativo)
        fim = total_relativo;
    for(i = (pag - 1) * limite; i < fim; i++){
        elementos[i].style.display = "block";
        //console.log(i);
    }
    //console.log(elementos);
    criar_paginacao();
}